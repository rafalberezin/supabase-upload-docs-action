# Metadata Management

This is an optional feature that allows the action to store project information
in your Supabase database.

## Database Integration

When the `meta-table` input is specified, the action inserts or updates a row in
the specified table. The action uses the project slug to find the row to update
(upsert operation).

## Table Requirements

Your database table should include columns for the metadata you want to store.
At minimum you need a column for the project slug. The column names can be
customized using the
[`column-mappings` input](../03-configuration.md#column-mappings).

> [!IMPORTANT]
>
> Your table schema must match the uploaded data or the action will fail. If you
> want to omit certain data from being uploaded you can also do that using
> `column-mappings`.

## Generated Data

The action automatically generates the following data fields:

| Field            | Type              | Description                          |
| ---------------- | ----------------- | ------------------------------------ |
| `slug`           | `TEXT`            | Project identifier in URLs           |
| `title`          | `TEXT`            | Project display name                 |
| `description`    | `TEXT`            | Project description                  |
| `license`        | `TEXT`            | Project license                      |
| `source`         | `TEXT`            | Project URL                          |
| `latest_version` | `TEXT`            | Latest release tag                   |
| `versions`       | `TEXT[]`          | Array of all release tags            |
| `articles`       | `JSON` or `JSONB` | Generated article map tree structure |

### Data Sources

The metadata comes from multiple sources:

1. **Repository Information**: Fetched from GitHub API using the provided token.
   - Repository name - Used to generate `slug` and `title`.
   - `description` - Repository description.
   - `source` - Repository URL.
   - `license` - Repository license information. (`No license` when none is set)
   - `latest_version` and `versions` - Repository release information.
2. **Metadata File**: Optional YAML or JSON file.
   - Overrides for generated fields.
   - Custom fields.
3. **Generated Content**: Generated by the action.
   - `articles` - Article map tree structure.
   - Project `slug` and `title`, as explained in
     [Slugs and Titles](./00-slugs-and-titles.md#project-slug-and-title-priority).

The details of the article map will be explained in the
[next article](./03-article-mapping.md).

## Quick Look at Column Mappings

`column-mappings` input allows you to use different column names in your
database, or omit the column completely by mapping to `_`.

For example, with these mappings:

```yaml
column-mappings: |
  slug: project_slug,
  source: _
```

- `slug` will be uploaded to your database column `project_slug`.
- `source` will **not** be uploaded.

## Metadata file

### Overwriting Generated Data

The metadata file (.yml, .yaml or .json) located by the `meta-path` input allows
you to explicitly set a value for the project metadata instead of relying on the
action to generated it.

For example, you can explicitly set project slug and title like so:

```yaml
slug: my-project-slug
title: I wonder if anyone will actually read this
```

> [!IMPORTANT]
>
> If you're using `column-mappings` the data inside the metadata file must use
> your already mapped names.

### Custom Data

The metadata file also allows you to specify your own custom data that will be
uploaded into the database as is. For example:

```yaml
featured: true
color_theme: dark
tags:
  - documentation
  - publishing
```

> [!IMPORTANT]
>
> The database table must have matching columns for your custom data or the
> upload will fail.

## Database Schema Example

Here's an example SQL schema that supports all the generated fields plus custom
ones (highlights):

```sql lines|highlight=11-15
CREATE TABLE projects (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	slug TEXT UNIQUE NOT NULL,
	title TEXT NOT NULL,
	description TEXT,
	license TEXT,
	source TEXT,
	latest_version TEXT,
	versions TEXT[],
	articles JSONB,
	featured BOOLEAN DEFAULT FALSE,
	color_theme TEXT,
	tags TEXT[],
	created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
	updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

> [!TIP]
>
> You can create a `JSON` or `JSONB` column for project specific unstructured
> data.

## Next Steps

- [Article Mapping](./03-article-mapping.md) - Learn about article mapping.
- [Configuration](../03-configuration.md) - See all configuration options.
  - [Column Mappings](../03-configuration.md#column-mappings) - If you're
    interested in the column mappings specifically.
